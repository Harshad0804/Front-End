<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Language Translator</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: linear-gradient(180deg,#f8fafc,#ffffff); min-height:100vh; }
    .card { border-radius: 1rem; box-shadow: 0 10px 30px rgba(20,20,40,0.06); }
    textarea { resize: vertical; }
    .lang-select { min-width: 140px; }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="card p-4">
          <h3 class="mb-3">Language Translator</h3>
          <p class="text-muted">Translate text between languages using the LibreTranslate public API. Change the API endpoint in the JavaScript if you have your own.</p>

          <div class="row g-3 align-items-center">
            <div class="col-md-6">
              <label class="form-label">From</label>
              <div class="d-flex gap-2">
                <select id="sourceLang" class="form-select lang-select">
                  <option value="auto">Auto-detect</option>
                </select>
                <button id="swapBtn" class="btn btn-outline-secondary" title="Swap languages">⤺</button>
              </div>
            </div>

            <div class="col-md-6">
              <label class="form-label">To</label>
              <select id="targetLang" class="form-select lang-select">
              </select>
            </div>

            <div class="col-12">
              <label class="form-label">Text to translate</label>
              <textarea id="inputText" class="form-control" rows="5" placeholder="Type or paste text here..."></textarea>
            </div>

            <div class="col-12 d-flex gap-2">
              <button id="translateBtn" class="btn btn-primary">Translate</button>
              <button id="clearBtn" class="btn btn-outline-secondary">Clear</button>
              <div class="ms-auto">
                <small class="text-muted">API:</small>
                <code id="apiEndpoint" class="small">https://libretranslate.de/translate</code>
              </div>
            </div>

            <div class="col-12">
              <label class="form-label">Translation</label>
              <div class="card p-3 bg-light" id="resultBox" style="min-height:110px; white-space:pre-wrap;"></div>
            </div>

            <div class="col-12 d-flex gap-2">
              <button id="copyBtn" class="btn btn-outline-success">Copy</button>
              <button id="speakBtn" class="btn btn-outline-info">Speak</button>
              <div class="ms-auto text-end text-muted small" id="status"></div>
            </div>

          </div>
        </div>

        <div class="mt-3 text-muted small">Fallback: if the API is blocked, the app will attempt a tiny offline dictionary for a few common phrases.</div>
      </div>
    </div>
  </div>

  <script>
    // ---------- Configuration ----------
    // Change this endpoint if you run your own instance or want a different public mirror
    const API_ENDPOINT = 'https://libretranslate.de/translate';
    const LANGS = [
      {code:'en', name:'English'},
      {code:'es', name:'Spanish'},
      {code:'fr', name:'French'},
      {code:'de', name:'German'},
      {code:'hi', name:'Hindi'},
      {code:'ar', name:'Arabic'},
      {code:'ru', name:'Russian'},
      {code:'zh', name:'Chinese (simplified)'},
      {code:'ja', name:'Japanese'},
      {code:'pt', name:'Portuguese'},
      {code:'bn', name:'Bengali'},
      {code:'ta', name:'Tamil'},
      {code:'te', name:'Telugu'},
      {code:'kn', name:'Kannada'}
    ];

    // Tiny offline fallback dictionary (very limited)
    const OFFLINE_DICTIONARY = {
      'hello': {en:'hello', hi:'नमस्ते', es:'hola', fr:'bonjour'},
      'thank you': {en:'thank you', hi:'धन्यवाद', es:'gracias', fr:'merci'},
      'goodbye': {en:'goodbye', hi:'अलविदा', es:'adiós', fr:'au revoir'}
    };

    // ---------- UI references ----------
    const sourceSel = document.getElementById('sourceLang');
    const targetSel = document.getElementById('targetLang');
    const inputText = document.getElementById('inputText');
    const translateBtn = document.getElementById('translateBtn');
    const resultBox = document.getElementById('resultBox');
    const statusEl = document.getElementById('status');
    const swapBtn = document.getElementById('swapBtn');
    const clearBtn = document.getElementById('clearBtn');
    const copyBtn = document.getElementById('copyBtn');
    const speakBtn = document.getElementById('speakBtn');
    const apiEndpointEl = document.getElementById('apiEndpoint');

    apiEndpointEl.textContent = API_ENDPOINT;

    // populate selects
    function populateLangs() {
      LANGS.forEach(l => {
        const opt1 = document.createElement('option');
        opt1.value = l.code; opt1.textContent = l.name + ' (' + l.code + ')';
        sourceSel.appendChild(opt1);

        const opt2 = document.createElement('option');
        opt2.value = l.code; opt2.textContent = l.name + ' (' + l.code + ')';
        targetSel.appendChild(opt2);
      });
      // defaults
      sourceSel.value = 'auto';
      targetSel.value = 'hi';
    }

    populateLangs();

    // swap source/target (preserving 'auto' behavior)
    swapBtn.addEventListener('click', ()=>{
      const s = sourceSel.value;
      const t = targetSel.value;
      // if source is auto, set source to target and target to auto
      if (s === 'auto') {
        sourceSel.value = t;
        targetSel.value = s;
      } else {
        sourceSel.value = t;
        targetSel.value = s;
      }
    });

    clearBtn.addEventListener('click', ()=>{
      inputText.value = '';
      resultBox.textContent = '';
      statusEl.textContent = '';
    });

    copyBtn.addEventListener('click', async ()=>{
      try {
        await navigator.clipboard.writeText(resultBox.textContent || '');
        statusEl.textContent = 'Copied!';
        setTimeout(()=>statusEl.textContent='','1200');
      } catch (e) {
        statusEl.textContent = 'Copy failed';
      }
    });

    speakBtn.addEventListener('click', ()=>{
      const text = resultBox.textContent.trim();
      if (!text) return;
      const utter = new SpeechSynthesisUtterance(text);
      // attempt to pick a voice that matches the target language
      const target = targetSel.value;
      const voices = speechSynthesis.getVoices() || [];
      const v = voices.find(x => x.lang && x.lang.startsWith(target));
      if (v) utter.voice = v;
      speechSynthesis.speak(utter);
    });

    // main translate action
    translateBtn.addEventListener('click', async ()=>{
      const text = inputText.value.trim();
      if (!text) {
        resultBox.textContent = '';
        statusEl.textContent = 'Enter text to translate';
        return;
      }
      resultBox.textContent = '';
      statusEl.textContent = 'Translating...';

      const payload = {
        q: text,
        source: sourceSel.value,
        target: targetSel.value,
        format: 'text'
      };

      try {
        const resp = await fetch(API_ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!resp.ok) throw new Error('API returned ' + resp.status);
        const data = await resp.json();
        if (data && (data.translatedText || data.translation)) {
          // LibreTranslate returns { translatedText: '...' }
          const translated = data.translatedText || data.translation;
          resultBox.textContent = translated;
          statusEl.textContent = 'Done';
        } else if (typeof data === 'string') {
          resultBox.textContent = data;
          statusEl.textContent = 'Done';
        } else {
          // fallback to tiny offline dictionary
          const fallback = offlineTranslate(text, targetSel.value);
          resultBox.textContent = fallback;
          statusEl.textContent = 'Used offline fallback';
        }
      } catch (err) {
        console.warn('Translate error:', err);
        // offline fallback (very small)
        const fallback = offlineTranslate(text, targetSel.value);
        resultBox.textContent = fallback;
        statusEl.textContent = 'API failed — used offline fallback';
      }
    });

    // extremely small offline "translation" — just maps exact phrases
    function offlineTranslate(text, target) {
      const key = text.toLowerCase().trim();
      for (const k in OFFLINE_DICTIONARY) {
        if (k === key && OFFLINE_DICTIONARY[k][target]) return OFFLINE_DICTIONARY[k][target];
      }
      // if not found, return original text (no translation available)
      return text + '\n\n[No translation available offline]';
    }

    // allow pressing Ctrl+Enter to translate
    inputText.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) translateBtn.click();
    });

    // helpful: detect languages endpoint (optional, not used here)
    // End.
  </script>

  <!-- Bootstrap JS (for some components) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
